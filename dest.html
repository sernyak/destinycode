<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Code - –¢–≤—ñ–π AI-–ê—Å—Ç—Ä–æ–ª–æ–≥</title>
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Astrologia.js (–ê—Å—Ç—Ä–æ-–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä) -->
    <script src="https://unpkg.com/astrologia@latest/dist/astrologia.umd.js"></script>
    <!-- –®—Ä–∏—Ñ—Ç Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- –ë–∞–∑–æ–≤—ñ –ó–º—ñ–Ω–Ω—ñ --- */
        :root {
            --bg-color: #121212;
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #a0a0a0;
            --accent-color: #cda45e; /* –ó–æ–ª–æ—Ç–∏–π –∞–∫—Ü–µ–Ω—Ç */
            --card-bg-color: #1a1a1a;
            --border-color: #333333;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text-color);
            /* –ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –¥–ª—è "–ø—Ä–µ–º—ñ—É–º" –≤—ñ–¥—á—É—Ç—Ç—è */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –ø–æ–ª—ñ–≤ –≤–≤–æ–¥—É */
        .custom-input-group input[type="date"],
        .custom-input-group input[type="time"],
        .custom-input-group input[type="text"],
        .custom-input-group input[type="email"] {
            background-color: transparent !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            color: var(--primary-text-color) !important;
            outline: none !important;
            width: 100%;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è, –∫–æ–ª–∏ —ñ–Ω–ø—É—Ç –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ */
        .placeholder-text {
            color: var(--secondary-text-color);
            pointer-events: none; /* –î–æ–∑–≤–æ–ª—è—î –∫–ª—ñ–∫–Ω—É—Ç–∏ –Ω–∞ —ñ–Ω–ø—É—Ç –ø—ñ–¥ –Ω–∏–º */
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 1rem;
            transition: color 0.2s;
        }
        
        /* –ó–≤—ñ—Ç - —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Gemini */
        .report-content p, .report-content ul, .report-content ol, .report-content h3 {
            margin-bottom: 1.5rem;
            line-height: 1.8;
            color: var(--primary-text-color);
        }
        .report-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        .report-content ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–ø—ñ–Ω–Ω–µ—Ä–∞ */
        .lds-dual-ring {
            display: inline-block;
            width: 80px;
            height: 80px;
        }
        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            margin: 8px;
            border-radius: 50%;
            border: 6px solid #fff;
            border-color: #fff transparent #fff transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }
        @keyframes lds-dual-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–¥–∞—Ç–∫—É -->
    <div id="app-container" class="w-full max-w-lg mx-auto bg-card-bg-color rounded-xl shadow-2xl p-6 md:p-8 transition-all duration-300">

        <!-- –°–µ–∫—Ü—ñ—è 1: –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö (landing-step) -->
        <div id="step-1" class="step" data-step="1">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-3 leading-tight text-accent-color">
                –í–∞—à –ö–æ—Å–º—ñ—á–Ω–∏–π –ö–æ–º–ø–∞—Å
            </h1>
            <h2 class="text-xl md:text-2xl font-medium text-center mb-8 text-primary-text-color">
                –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è, –¥–ª—è —á–æ–≥–æ –≤–∏ –Ω–∞—Ä–æ–¥–∂–µ–Ω—ñ, –∑–∞ 30 —Å–µ–∫—É–Ω–¥
            </h2>
            
            <form id="birthForm" class="space-y-4">
                
                <!-- –ü–æ–ª–µ –î–∞—Ç–∞ -->
                <div class="custom-input-group bg-card-bg-color border border-border-color rounded-lg p-3 relative">
                    <label class="text-sm font-medium text-secondary-text-color block mb-1">–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</label>
                    <!-- –ö–∞—Å—Ç–æ–º–Ω–∏–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä -->
                    <span id="date-placeholder" class="placeholder-text text-lg">–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É</span>
                    <input type="date" id="birthDate" name="birthDate" required 
                           class="w-full h-8 opacity-0 relative z-10" 
                           max="<?php echo date('Y-m-d'); ?>">
                </div>

                <!-- –ü–æ–ª–µ –ß–∞—Å -->
                <div class="custom-input-group bg-card-bg-color border border-border-color rounded-lg p-3 relative">
                    <label class="text-sm font-medium text-secondary-text-color block mb-1">–¢–æ—á–Ω–∏–π —á–∞—Å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</label>
                    <!-- –ö–∞—Å—Ç–æ–º–Ω–∏–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä -->
                    <span id="time-placeholder" class="placeholder-text text-lg">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å (–±–∞–∂–∞–Ω–æ)</span>
                    <input type="time" id="birthTime" name="birthTime" 
                           class="w-full h-8 opacity-0 relative z-10">
                </div>
                
                <!-- –ü–æ–ª–µ –ú—ñ—Å—Ç–æ -->
                <div class="custom-input-group bg-card-bg-color border border-border-color rounded-lg p-3">
                    <label for="birthCity" class="text-sm font-medium text-secondary-text-color block mb-1">–ú—ñ—Å—Ç–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</label>
                    <input type="text" id="birthCity" name="birthCity" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ö–∏—ó–≤" required
                           class="w-full h-8 text-lg" autocomplete="off">
                </div>

                <!-- –ü–æ–ª–µ Email (–ø—Ä–∏—Ö–æ–≤–∞–Ω–µ/–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–µ –¥–ª—è –ø–µ—Ä—à–æ–≥–æ –∫—Ä–æ–∫—É) -->
                <div class="custom-input-group bg-card-bg-color border border-border-color rounded-lg p-3 hidden">
                    <label for="userEmail" class="text-sm font-medium text-secondary-text-color block mb-1">–í–∞—à Email (–¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–≤—ñ—Ç—É)</label>
                    <input type="email" id="userEmail" name="userEmail" placeholder="email@example.com"
                           class="w-full h-8 text-lg">
                </div>

                <button type="submit" 
                        class="w-full py-3 px-4 bg-accent-color text-black font-bold text-xl rounded-lg shadow-lg hover:bg-yellow-600 transition duration-150 transform hover:scale-105">
                    –û—Ç—Ä–∏–º–∞—Ç–∏ –ê—Å—Ç—Ä–æ-–ó–≤—ñ—Ç
                </button>
            </form>
        </div>

        <!-- –°–µ–∫—Ü—ñ—è 2: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (loading-step) -->
        <div id="step-2" class="step hidden text-center" data-step="2">
            <div class="flex justify-center items-center h-40">
                <div class="lds-dual-ring" style="border-color: var(--accent-color) transparent var(--accent-color) transparent;"></div>
            </div>
            <h3 class="text-xl font-semibold mb-4 text-primary-text-color">–ì–æ—Ç—É—î–º–æ –≤–∞—à AI-–∞–Ω–∞–ª—ñ–∑...</h3>
            <p id="loading-text" class="text-secondary-text-color h-12"></p>
        </div>
        
        <!-- –°–µ–∫—Ü—ñ—è 3: –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ó–≤—ñ—Ç (result-step) -->
        <div id="step-3" class="step hidden" data-step="3">
            <h3 class="text-2xl font-bold text-center mb-6 text-accent-color">–í–∞—à–µ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è: –ü–µ—Ä—à–∏–π –ü–æ–≥–ª—è–¥</h3>
            
            <div id="free-report-content" class="report-content bg-card-bg-color p-4 rounded-lg border border-border-color">
                <!-- –°—é–¥–∏ –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –≤—ñ–¥ Gemini -->
                <p class="text-secondary-text-color text-center py-8">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            </div>

            <div class="mt-6 p-4 bg-red-900/30 border border-red-700 rounded-lg text-sm text-red-300">
                <p class="font-bold mb-2">–í–∞–∂–ª–∏–≤–æ!</p>
                <p>–¶–µ–π –∑–≤—ñ—Ç —î –ª–∏—à–µ **5%** –≤—ñ–¥ –ø–æ–≤–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É. –í—ñ–Ω –¥–∞—î –∑–∞–≥–∞–ª—å–Ω–µ —É—è–≤–ª–µ–Ω–Ω—è. –í—Å—ñ –¥–µ—Ç–∞–ª—ñ –ø—Ä–æ –∫–∞—Ä'—î—Ä—É, —Ñ—ñ–Ω–∞–Ω—Å–∏ —Ç–∞ —Å—Ç–æ—Å—É–Ω–∫–∏ —î —á–∞—Å—Ç–∏–Ω–æ—é –ø–æ–≤–Ω–æ–≥–æ AI-–ê–Ω–∞–ª—ñ–∑—É.
            </div>

            <button id="showPremiumData"
                    class="w-full mt-6 py-3 px-4 bg-accent-color text-black font-bold text-xl rounded-lg shadow-lg hover:bg-yellow-600 transition duration-150 transform hover:scale-105">
                –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏
            </button>
        </div>

        <!-- –°–µ–∫—Ü—ñ—è 4: –î–∞–Ω—ñ –¥–ª—è –ü—Ä–µ–º—ñ—É–º (premium-data-step) -->
        <div id="step-4" class="step hidden" data-step="4">
            <h3 class="text-2xl font-bold text-center mb-6 text-accent-color">–î–ª—è –ü–æ–≤–Ω–æ–≥–æ –ê–Ω–∞–ª—ñ–∑—É –ü–æ—Ç—Ä—ñ–±–µ–Ω Email</h3>
            <p class="text-center text-secondary-text-color mb-6">–í–≤–µ–¥—ñ—Ç—å –≤–∞—à email, —â–æ–± –º–∏ –º–æ–≥–ª–∏ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤–Ω–∏–π, –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π 12-—Å—Ç–æ—Ä—ñ–Ω–∫–æ–≤–∏–π –∑–≤—ñ—Ç –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏.</p>
            
            <form id="emailForm" class="space-y-4">
                <div class="custom-input-group bg-card-bg-color border border-border-color rounded-lg p-3">
                    <label for="premiumEmailInput" class="text-sm font-medium text-secondary-text-color block mb-1">–í–∞—à Email</label>
                    <input type="email" id="premiumEmailInput" name="premiumEmailInput" placeholder="email@example.com" required
                           class="w-full h-8 text-lg">
                </div>
                
                <button type="submit" 
                        class="w-full py-3 px-4 bg-accent-color text-black font-bold text-xl rounded-lg shadow-lg hover:bg-yellow-600 transition duration-150 transform hover:scale-105">
                    –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –û–ø–ª–∞—Ç–∏ (–ü–æ–≤–Ω–∏–π –ó–≤—ñ—Ç)
                </button>
                
                <button type="button" id="skipPremiumData"
                        class="w-full mt-2 py-2 text-secondary-text-color font-medium hover:text-primary-text-color transition duration-150">
                    –ù—ñ, –¥—è–∫—É—é (–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ—ó)
                </button>
            </form>
        </div>

        <!-- –°–µ–∫—Ü—ñ—è 5: –û–ø–ª–∞—Ç–∞ (final-paywall-step) -->
        <div id="step-5" class="step hidden text-center" data-step="5">
            <h3 class="text-2xl font-bold mb-4 text-accent-color">–ü–æ–≤–Ω–∏–π AI-–ê–Ω–∞–ª—ñ–∑ –í–∞—à–æ—ó –î–æ–ª—ñ</h3>
            <p class="text-lg mb-8 text-primary-text-color">–û—Ç—Ä–∏–º–∞–π—Ç–µ 12-—Å—Ç–æ—Ä—ñ–Ω–∫–æ–≤–∏–π –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç –ø—Ä–æ –≤–∞—à–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è, –∫–∞—Ä'—î—Ä—É —Ç–∞ —Å—Ç–æ—Å—É–Ω–∫–∏.</p>
            
            <div class="text-left bg-gray-800 p-4 rounded-lg mb-6">
                <ul class="space-y-3 list-disc list-inside">
                    <li>–¢–æ—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏ (Astrologia.js).</li>
                    <li>–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü—ñ—è –≤—ñ–¥ Gemini Flash.</li>
                    <li>–†–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∞ –∫–∞—Ä–º—ñ—á–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å.</li>
                    <li>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–∞–π–±–ª–∏–∂—á—ñ 6 –º—ñ—Å—è—Ü—ñ–≤.</li>
                </ul>
            </div>

            <p class="text-3xl font-bold mb-6 text-primary-text-color">
                –¶—ñ–Ω–∞: <span class="text-accent-color">‚Ç¨2.49</span>
            </p>
            
            <button id="payButton"
                    class="w-full py-4 px-4 bg-accent-color text-black font-bold text-xl rounded-lg shadow-lg hover:bg-yellow-600 transition duration-150 transform hover:scale-105">
                –°–ø–ª–∞—Ç–∏—Ç–∏ ‚Ç¨2.49 —Ç–∞ –û—Ç—Ä–∏–º–∞—Ç–∏ –ó–≤—ñ—Ç
            </button>
            
            <!-- –¢—É—Ç –±—É–¥—É—Ç—å –∫–Ω–æ–ø–∫–∏ Apple Pay / Google Pay -->
            <div id="payment-shortcuts" class="mt-4 space-y-2">
                <p class="text-sm text-secondary-text-color">–ê–±–æ —Å–ø–ª–∞—Ç—ñ—Ç—å —à–≤–∏–¥–∫–æ:</p>
                <div class="flex justify-center space-x-4">
                    <button class="flex items-center justify-center w-1/2 py-3 bg-white text-black font-semibold rounded-lg shadow-md">
                        [Apple Pay]
                    </button>
                    <button class="flex items-center justify-center w-1/2 py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md">
                        [Google Pay]
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü—ñ—è 6: –£—Å–ø—ñ—à–Ω–∞ –û–ø–ª–∞—Ç–∞ —Ç–∞ –§—ñ–Ω–∞–ª—å–Ω–∏–π –ó–≤—ñ—Ç (success-step) -->
        <div id="step-6" class="step hidden" data-step="6">
            <h3 class="text-3xl font-bold text-center mb-6 text-green-400">‚úÖ –û–ø–ª–∞—Ç–∞ –£—Å–ø—ñ—à–Ω–∞!</h3>
            <p class="text-center text-lg mb-8 text-primary-text-color">–í–∞—à –ø–æ–≤–Ω–∏–π, –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è. –¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –¥–æ 60 —Å–µ–∫—É–Ω–¥.</p>
            
            <!-- –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É -->
            <div id="report-loading-indicator" class="text-center py-10">
                <div class="lds-dual-ring mx-auto" style="border-color: #00ff00 transparent #00ff00 transparent;"></div>
            </div>

            <div id="full-report-content" class="report-content mt-6 hidden bg-card-bg-color p-4 rounded-lg border border-border-color">
                <!-- –°—é–¥–∏ –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –ø–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –≤—ñ–¥ Gemini -->
            </div>
            
            <!-- –°–µ–∫—Ü—ñ—è LTV / Upsell (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É) -->
            <div id="ltv-upsell-box" class="mt-8 p-4 bg-purple-900/30 border border-purple-700 rounded-lg hidden">
                <h4 class="text-xl font-bold text-purple-300 mb-3">üî• –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è!</h4>
                <p class="text-primary-text-color mb-4">
                    –î–æ–¥–∞–π—Ç–µ **–ü–æ–≤–Ω–∏–π –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 2025 —Ä—ñ–∫** (–≤–∫–ª—é—á–∞—é—á–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–∏) –≤—Å—å–æ–≥–æ –∑–∞ ‚Ç¨4.99 (–ó–Ω–∏–∂–∫–∞ 50%).
                </p>
                <button class="w-full py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition">
                    –î–æ–¥–∞—Ç–∏ –ü—Ä–æ–≥–Ω–æ–∑ (‚Ç¨4.99)
                </button>
            </div>
            
        </div>

    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è Alert'—ñ–≤ -->
    <div id="customAlertModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
        <div class="bg-card-bg-color p-6 rounded-xl shadow-2xl max-w-sm w-full border border-accent-color">
            <h4 id="alertTitle" class="text-xl font-bold mb-4 text-accent-color"></h4>
            <p id="alertMessage" class="mb-6 text-primary-text-color"></p>
            <button id="alertCloseButton" class="w-full py-2 bg-accent-color text-black font-bold rounded-lg hover:bg-yellow-600">–û–ö</button>
        </div>
    </div>


    <script type="module">
        // --- 1. –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü —Ç–∞ DOM –ï–õ–ï–ú–ï–ù–¢–ò ---
        const birthForm = document.getElementById('birthForm');
        const birthDateInput = document.getElementById('birthDate');
        const birthTimeInput = document.getElementById('birthTime');
        const birthCityInput = document.getElementById('birthCity');
        const userEmailInput = document.getElementById('userEmail'); // –ü—Ä–∏—Ö–æ–≤–∞–Ω–∏–π —ñ–Ω–ø—É—Ç
        
        const datePlaceholder = document.getElementById('date-placeholder');
        const timePlaceholder = document.getElementById('time-placeholder');
        
        const loadingTextEl = document.getElementById('loading-text');
        const freeReportContentEl = document.getElementById('free-report-content');
        
        const emailForm = document.getElementById('emailForm');
        const premiumEmailInput = document.getElementById('premiumEmailInput');
        const showPremiumDataBtn = document.getElementById('showPremiumData');
        const skipPremiumDataBtn = document.getElementById('skipPremiumData');

        const payButton = document.getElementById('payButton');

        const reportLoadingIndicator = document.getElementById('report-loading-indicator');
        const fullReportContentEl = document.getElementById('full-report-content');
        const ltvUpsellBox = document.getElementById('ltv-upsell-box');
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –ø–∞–º'—è—Ç—ñ (–∑–∞–º—ñ—Å—Ç—å sessionStorage, —è–∫ –±—É–ª–æ —É WayForPay)
        let userData = { date: '', time: '12:00', city: '', email: '' };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–º—ñ–Ω–Ω–æ—ó –¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó WayForPay
        let isPaymentSuccessful = false;

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∫—ñ–ø-–∫–Ω–æ–ø–∫–∏ (–ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –Ω–∞ 1 –∫—Ä–æ–∫)
        if (skipPremiumDataBtn) {
            skipPremiumDataBtn.addEventListener('click', () => {
                showStep(1); // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –Ω–∞ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∫—Ä–æ–∫
            });
        }
        
        // --- 2. –ü–†–û–ú–ü–¢–ò GEMINI ---
        const freeSystemPrompt = `–¢–∏ ‚Äî –≤–∏—Å–æ–∫–æ–∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π AI-–∞—Å—Ç—Ä–æ–ª–æ–≥ —Ç–∞ –∫–æ—É—á –∑ –ø—Ä–æ—Å—É–≤–∞–Ω–Ω—è–º –ø–ª–∞—Ç–Ω–∏—Ö –ø–æ—Å–ª—É–≥. –¢–≤–æ—è —Ü—ñ–ª—å ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–¥–∞–Ω–∏—Ö —Ç–æ—á–Ω–∏—Ö –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (–Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏) –Ω–∞–ø–∏—Å–∞—Ç–∏ –∑–∞—Ö–æ–ø–ª—é—é—á–∏–π, –∞–ª–µ –∫–æ—Ä–æ—Ç–∫–∏–π (–Ω–µ –±—ñ–ª—å—à–µ 300 —Å–ª—ñ–≤) "–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π" (lead magnet) –∑–≤—ñ—Ç, —è–∫–∏–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–æ—Ç–∏–≤—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∫—É–ø–∏—Ç–∏ –ø–æ–≤–Ω–∏–π –∞–Ω–∞–ª—ñ–∑.
        
        –Ü–ù–°–¢–†–£–ö–¶–Ü–á –î–û –ó–í–Ü–¢–£:
        1. –ó–∞–≥–æ–ª–æ–≤–æ–∫: –°—Ç–≤–æ—Ä–∏ –≥—É—á–Ω–∏–π, –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫.
        2. –ö–æ–Ω—Ç–µ–Ω—Ç: –û–ø–∏—à–∏ –ª–∏—à–µ –æ–¥–Ω—É, –∞–ª–µ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—É, –∫–æ—Å–º—ñ—á–Ω—É –µ–Ω–µ—Ä–≥—ñ—é, —è–∫–∞ —Å—Ç–æ—Å—É—î—Ç—å—Å—è **–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–±–æ –∫–∞—Ä'—î—Ä–∏**. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–æ–ª–æ–∂–µ–Ω–Ω—è –°–æ–Ω—Ü—è, –ú—ñ—Å—è—Ü—è —Ç–∞ –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç–∞.
        3. –°—Ç–∏–ª—å: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –µ–º–æ—Ü—ñ–π–Ω–∏–π, –∞–ª–µ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ç–æ–Ω.
        4. –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è: –ó–∞–≤–µ—Ä—à–∏ –∑–≤—ñ—Ç —á—ñ—Ç–∫–∏–º –Ω–∞—Ç—è–∫–æ–º –Ω–∞ —Ç–µ, —â–æ —Ü–µ –ª–∏—à–µ "–≤–µ—Ä—Ö—ñ–≤–∫–∞ –∞–π—Å–±–µ—Ä–≥–∞" —ñ **95%** –¥–µ—Ç–∞–ª–µ–π (—Ñ—ñ–Ω–∞–Ω—Å–∏, —Å—Ç–æ—Å—É–Ω–∫–∏, –ø—Ä–æ–≥–Ω–æ–∑) –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ —É –ø–æ–≤–Ω–æ–º—É –ø–ª–∞—Ç–Ω–æ–º—É –∑–≤—ñ—Ç—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ª–∏—à–µ –ø—Ä–æ—Å—Ç–∏–π HTML (p, strong, ul, li).
        `;

        const fullSystemPrompt = `–¢–∏ ‚Äî –≤–∏—Å–æ–∫–æ–∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π AI-–∞—Å—Ç—Ä–æ–ª–æ–≥ —Ç–∞ –∫–æ—É—á. –¢–≤–æ—è —Ü—ñ–ª—å ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–¥–∞–Ω–∏—Ö —Ç–æ—á–Ω–∏—Ö –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (–Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏), –Ω–∞–ø–∏—Å–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π, –≥–ª–∏–±–æ–∫–∏–π —Ç–∞ –º–æ—Ç–∏–≤—É—é—á–∏–π 12-—Å—Ç–æ—Ä—ñ–Ω–∫–æ–≤–∏–π –∑–≤—ñ—Ç (—ñ–º—ñ—Ç–∞—Ü—ñ—è).
        
        –Ü–ù–°–¢–†–£–ö–¶–Ü–á –î–û –ü–û–í–ù–û–ì–û –ó–í–Ü–¢–£:
        1. –û–±—Å—è–≥: –ó–≤—ñ—Ç –º–∞—î –±—É—Ç–∏ –æ–±'—î–º–Ω–∏–º, –∑ 5-7 –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º–∏ —Ä–æ–∑–¥—ñ–ª–∞–º–∏.
        2. –°—Ç–∏–ª—å: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π, –Ω–∞–¥–∏—Ö–∞—é—á–∏–π —Ç–æ–Ω.
        3. –†–æ–∑–¥—ñ–ª–∏:
           * **–í—Å—Ç—É–ø:** –ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –ø–æ–¥—è–∫–∞ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ç–æ—á–Ω–æ—Å—Ç—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤.
           * **–í–∞—à–µ –ö–æ—Å–º—ñ—á–Ω–µ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è (–°–æ–Ω—Ü–µ, –ú—ñ—Å—è—Ü—å, –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç):** –î–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä —Ç—Ä—å–æ—Ö –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö —Ç–æ—á–æ–∫.
           * **–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –ö–æ–¥ (2-–π —Ç–∞ 8-–π –î—ñ–º):** –ê–Ω–∞–ª—ñ–∑ –ø–æ—Ç–µ–Ω—Ü—ñ–∞–ª—É –∑–∞—Ä–æ–±—ñ—Ç–∫—É —Ç–∞ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ–π.
           * **–ö–∞—Ä'—î—Ä–∞ —Ç–∞ –°–æ—Ü—ñ–∞–ª—å–Ω–∞ –†–æ–ª—å (10-–π –î—ñ–º):** –®–ª—è—Ö –¥–æ —É—Å–ø—ñ—Ö—É —Ç–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó.
           * **–ö–∞—Ä–º—ñ—á–Ω—ñ –ó–∞–≤–¥–∞–Ω–Ω—è (–í—É–∑–ª–∏):** –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ —Ü—å–æ–º—É –∂–∏—Ç—Ç—ñ.
           * **–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –ù–∞—Å—Ç—É–ø–Ω—ñ 6 –ú—ñ—Å—è—Ü—ñ–≤ (–¢—Ä–∞–Ω–∑–∏—Ç–∏):** –û–ø–∏—à–∏ –∑–∞–≥–∞–ª—å–Ω—ñ —Ç–µ–Ω–¥–µ–Ω—Ü—ñ—ó.
           * **–í–∏—Å–Ω–æ–≤–æ–∫:** –ó–∞–∫–ª–∏–∫ –¥–æ –¥—ñ—ó —Ç–∞ –ø—ñ–¥—Å—É–º–æ–∫.
        4. –§–æ—Ä–º–∞—Ç: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ª–∏—à–µ –ø—Ä–æ—Å—Ç–∏–π HTML (h3, p, strong, ul, li). –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∑–∞–≥–æ–ª–æ–≤–∫–∏ h1/h2.
        `;

        // --- 2.2. –î–û–î–ê–¢–ö–û–í–ò–ô –ü–†–û–ú–ü–¢ –î–õ–Ø GEOCoding ---
        const GEO_SYSTEM_PROMPT = `–¢–∏ ‚Äî –≤–∏—Å–æ–∫–æ—Ç–æ—á–Ω–∏–π –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π API. –¢–≤–æ—è —î–¥–∏–Ω–∞ –º–µ—Ç–∞ ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ JSON-–æ–±'—î–∫—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (lat, lon) —Ç–∞ —á–∞—Å–æ–≤–∏–π –ø–æ—è—Å (timezone) –¥–ª—è –≤–∫–∞–∑–∞–Ω–æ–≥–æ –º—ñ—Å—Ç–∞.
        –ü–†–ê–í–ò–õ–ê:
        1. –í—ñ–¥–ø–æ–≤—ñ–¥—å –º–∞—î –±—É—Ç–∏ –õ–ò–®–ï –≤ —Ñ–æ—Ä–º–∞—Ç—ñ JSON. –ñ–æ–¥–Ω–∏—Ö –ø–æ—è—Å–Ω–µ–Ω—å —á–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É.
        2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ñ–æ—Ä–º–∞—Ç –¥–µ—Å—è—Ç–∏—Ö–≤–∏–ª–∏–Ω–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 49.8397).
        3. –ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å –º–∞—î –±—É—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ IANA (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Europe/Kyiv).
        4. –ü—Ä–∏–∫–ª–∞–¥: {"lat": 49.8397, "lon": 24.0297, "timezone": "Europe/Kyiv"}
        5. –ü–æ–≤–µ—Ä–Ω–∏ JSON-–æ–±'—î–∫—Ç, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –º—ñ—Å—Ç–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –Ω—É–ª—ñ —Ç–∞ null).
        `;
        
        // --- 3. –§–£–ù–ö–¶–Ü–Ø –í–ò–ö–õ–ò–ö–£ GEMINI API ---
        // –î–æ–¥–∞–Ω–æ –∞—Ä–≥—É–º–µ–Ω—Ç `jsonMode` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º false) –¥–ª—è Geocoding
        async function callGeminiAPI(systemPrompt, userQuery, jsonMode = false) { 
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };
            
            // –Ø–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π —Ä–µ–∂–∏–º JSON, –¥–æ–¥–∞—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
            if (jsonMode) {
                payload.generationConfig = {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            lat: { type: "number", description: "–ì–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∞ —à–∏—Ä–æ—Ç–∞" },
                            lon: { type: "number", description: "–ì–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∞ –¥–æ–≤–≥–æ—Ç–∞" },
                            timezone: { type: "string", description: "–ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å —É —Ñ–æ—Ä–º–∞—Ç—ñ IANA, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ Europe/Kyiv" }
                        },
                        required: ["lat", "lon", "timezone"]
                    }
                };
            }

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                console.error("API Error Response:", result);
                throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Gemini API.");
            }
        }

        // --- 2.3. –§–£–ù–ö–¶–Ü–Ø –ê–°–¢–†–û–ù–û–ú–Ü–ß–ù–ò–• –†–û–ó–†–ê–•–£–ù–ö–Ü–í (–ö—Ä–æ–∫ 3) ---
        async function getAstroData(cityName, dateStr, timeStr) {
            const tempAlert = alertModal("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è", "–®—É–∫–∞—î–º–æ –≤–∞—à–µ –º—ñ—Å—Ç–æ —Ç–∞ –≤–∏–∫–æ–Ω—É—î–º–æ –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—á–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏...", true);
            try {
                // 1. Geocoding: –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å—É –≤—ñ–¥ Gemini
                const geoQuery = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–∞ —á–∞—Å–æ–≤–∏–π –ø–æ—è—Å –¥–ª—è –º—ñ—Å—Ç–∞: ${cityName}`;
                
                // –í–∏–∫–ª–∏–∫–∞—î–º–æ Gemini –∑ JSON-—Å—Ö–µ–º–æ—é –¥–ª—è Geocoding
                const geoResponseText = await callGeminiAPI(GEO_SYSTEM_PROMPT, geoQuery, true); // true - —Ü–µ JSON mode
                const geoData = JSON.parse(geoResponseText);

                if (!geoData.lat || !geoData.lon || !geoData.timezone) {
                    throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ—á–Ω—ñ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω—ñ –¥–∞–Ω—ñ –≤—ñ–¥ Gemini.");
                }

                // 2. Astrologia Calculation: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏
                const [year, month, day] = dateStr.split('-').map(Number);
                const [hour, minute] = timeStr.split(':').map(Number);
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç –¥–∞—Ç–∏ (Astrologia –ø—Ä–∞—Ü—é—î –∑ –ª–æ–∫–∞–ª—å–Ω–∏–º —á–∞—Å–æ–º, –¥–∞–ª—ñ –∫–æ–Ω–≤–µ—Ä—Ç—É—î —Å–∞–º–∞)
                const date = new Date(year, month - 1, day, hour, minute); 
                
                // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è Astrologia.js
                const settings = {
                    method: 'placidus',
                    lat: geoData.lat,
                    lon: geoData.lon,
                    // Astrologia –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Timezone String (IANA) –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –≤ UTC
                    tz: geoData.timezone 
                };

                const chart = new astrologia.Chart(date, settings);
                
                // –ó–±–∏—Ä–∞—î–º–æ –æ—Å–Ω–æ–≤–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –≤ –≥–æ–ª–æ–≤–Ω–∏–π –ø—Ä–æ–º–ø—Ç Gemini
                const ascendant = chart.houses.cusps[1].toFixed(2);
                const sun = chart.planets.sun.position.toFixed(2);
                const moon = chart.planets.moon.position.toFixed(2);
                const houses = chart.houses.cusps.slice(1).map(c => c.toFixed(2)); // –ó 1 –ø–æ 12 –¥—ñ–º
                
                // –ü–ª–∞–Ω–µ—Ç–∏ –ø–æ –∑–Ω–∞–∫–∞—Ö
                const planetPositions = Object.keys(chart.planets).map(key => {
                    const planet = chart.planets[key];
                    return `${key.charAt(0).toUpperCase() + key.slice(1)}: ${planet.sign.name} (${planet.position.toFixed(2)})`;
                });

                const natalChartData = {
                    ascendant: ascendant,
                    sun: sun,
                    moon: moon,
                    houses: houses,
                    planetPositions: planetPositions.join('; ')
                };
                
                console.log('--- –ì–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è (Gemini) ---', geoData);
                console.log('--- –ê—Å—Ç—Ä–æ-–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ (Astrologia) ---', natalChartData);

                return { geoData, natalChartData };

            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –≤ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –∞—Å—Ç—Ä–æ-–¥–∞–Ω–∏—Ö –∞–±–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞—Ö:", error);
                alertModal("–ü–æ–º–∏–ª–∫–∞", error.message || "–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏.");
                showStep(1);
                // –£ –≤–∏–ø–∞–¥–∫—É –ø–æ–º–∏–ª–∫–∏ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø—É—Å—Ç—ñ –¥–∞–Ω—ñ, —â–æ–± –Ω–µ –∑—É–ø–∏–Ω—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å
                return { geoData: null, natalChartData: null };
            } finally {
                if (tempAlert) tempAlert.close();
            }
        }

        // --- 4. –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á UI ---
        
        // –ö–∞—Å—Ç–æ–º–Ω–∏–π Alert Modal
        function alertModal(title, message, isLoader = false) {
            const modal = document.getElementById('customAlertModal');
            const titleEl = document.getElementById('alertTitle');
            const messageEl = document.getElementById('alertMessage');
            const closeBtn = document.getElementById('alertCloseButton');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            if (isLoader) {
                closeBtn.style.display = 'none';
                modal.classList.remove('hidden');
                return { close: () => modal.classList.add('hidden') };
            }

            closeBtn.style.display = 'block';
            modal.classList.remove('hidden');

            const handler = () => {
                modal.classList.add('hidden');
                closeBtn.removeEventListener('click', handler);
            };
            closeBtn.addEventListener('click', handler);
        }

        // –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫—Ä–æ–∫–∞–º–∏ (step-by-step UI)
        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                const currentStep = parseInt(step.getAttribute('data-step'));
                step.classList.toggle('hidden', currentStep !== stepNumber);
            });
            // –Ø–∫—â–æ –∫—Ä–æ–∫ 2 (–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è), –∑–∞–ø—É—Å–∫–∞—î–º–æ –µ—Ñ–µ–∫—Ç –¥—Ä—É–∫–∞—Ä—Å—å–∫–æ—ó –º–∞—à–∏–Ω–∫–∏
            if (stepNumber === 2) {
                startLoadingAnimation();
            }
        }
        
        // –ï—Ñ–µ–∫—Ç –¥—Ä—É–∫–∞—Ä—Å—å–∫–æ—ó –º–∞—à–∏–Ω–∫–∏ –¥–ª—è –∫—Ä–æ–∫—É 2
        const loadingMessages = [
            "–ó—á–∏—Ç—É—î–º–æ –µ–Ω–µ—Ä–≥—ñ—é –∑ –≤–∞—à–æ–≥–æ –º—ñ—Å—Ç–∞...",
            "–ö–æ–Ω—Å—É–ª—å—Ç—É—î–º–æ—Å—å —ñ–∑ –∑—ñ—Ä–∫–æ–≤–æ—é –º–∞–ø–æ—é...",
            "AI-–∞–ª–≥–æ—Ä–∏—Ç–º–∏ –∞–Ω–∞–ª—ñ–∑—É—é—Ç—å –≤–∞—à—ñ –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ñ –ø–æ–ª–æ–∂–µ–Ω–Ω—è...",
            "–§–æ—Ä–º—É—î–º–æ –ø–µ—Ä—à–∏–π –±–ª–æ–∫ –∑–≤—ñ—Ç—É..."
        ];
        let messageIndex = 0;
        let charIndex = 0;
        let animationInterval;

        function startLoadingAnimation() {
            messageIndex = 0;
            charIndex = 0;
            if (animationInterval) clearInterval(animationInterval);
            loadingTextEl.textContent = '';
            
            animationInterval = setInterval(() => {
                const currentMessage = loadingMessages[messageIndex];
                if (charIndex < currentMessage.length) {
                    loadingTextEl.textContent += currentMessage.charAt(charIndex);
                    charIndex++;
                } else {
                    // –ö—ñ–Ω–µ—Ü—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ
                    setTimeout(() => {
                        messageIndex = (messageIndex + 1) % loadingMessages.length;
                        charIndex = 0;
                        loadingTextEl.textContent = '';
                    }, 2000); // –ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                }
            }, 75); // –®–≤–∏–¥–∫—ñ—Å—Ç—å –¥—Ä—É–∫—É–≤–∞–Ω–Ω—è
        }
        
        // –û—á–∏—â–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫—Ä–æ–∫—É
        function stopLoadingAnimation() {
            if (animationInterval) clearInterval(animationInterval);
        }

        // –û—á–∏—â–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑–≤—ñ—Ç—É –≤—ñ–¥ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤, —è–∫—ñ –º–æ–∂–µ –¥–æ–¥–∞—Ç–∏ Gemini
        function formatReport(rawText) {
            // –í–∏–¥–∞–ª—è—î–º–æ –º–∞—Ä–∫–¥–∞—É–Ω-–±–ª–æ–∫–∏ —Ç–∞ –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏/–Ω–æ–≤–∏–π —Ä—è–¥–æ–∫
            let formattedText = rawText.replace(/```html|```|```json|```/g, '').trim();
            // –î–µ—è–∫–∏–π —Ç–µ–∫—Å—Ç –º–æ–∂–µ –±—É—Ç–∏ –≤ Markdown, –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ HTML
            formattedText = formattedText.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            formattedText = formattedText.replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>');
            formattedText = formattedText.replace(/^- (.*$)/gim, '<li>$1</li>'); // –ü—Ä–æ—Å—Ç–∏–π —Å–ø–∏—Å–æ–∫

            // –ó–∞–±–µ–∑–ø–µ—á—É—î–º–æ –æ–±–≥–æ—Ä—Ç–∞–Ω–Ω—è —É <p>
            if (!formattedText.startsWith('<p>') && !formattedText.startsWith('<h3')) {
                formattedText = `<p>${formattedText}</p>`;
            }
            return formattedText;
        }

        // --- 5. –§–£–ù–ö–¶–Ü–á –ì–ï–ù–ï–†–ê–¶–Ü–á –ó–í–Ü–¢–Ü–í ---

        // --- 5.1. –ó–ê–ü–£–°–ö –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ë–ï–ó–ö–û–®–¢–û–í–ù–û–ì–û –∑–≤—ñ—Ç—É (–ö—Ä–æ–∫ 3 - Lead Magnet) ---
        async function fetchFreeAnalysis(data, astroResult) {
            // –î–æ–¥–∞—î–º–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –¥–æ –ø—Ä–æ–º–ø—Ç—É
            let userQuery = `–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${data.date}.`;
            if (data.time) userQuery += ` –ß–∞—Å: ${data.time}.`;
            if (data.city) userQuery += ` –ú—ñ—Å—Ç–æ: ${data.city}.`;
            
            // –î–û–î–ê–ù–û: –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–∞–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏
            if (astroResult && astroResult.natalChartData) {
                const chart = astroResult.natalChartData;
                userQuery += ` –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–∞–Ω—ñ –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —ó—Ö —è–∫ —Ç–æ—á–Ω—É –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—É –æ—Å–Ω–æ–≤—É): –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç: ${chart.ascendant} –≥—Ä. –°–æ–Ω—Ü–µ: ${chart.sun} –≥—Ä. –ú—ñ—Å—è—Ü—å: ${chart.moon} –≥—Ä. –ü–æ–ª–æ–∂–µ–Ω–Ω—è –ø–ª–∞–Ω–µ—Ç: ${chart.planetPositions}. –ö—É—Å–ø—ñ–¥–∏ –î–æ–º—ñ–≤: [${chart.houses.join(', ')}].`;
                // –û–Ω–æ–≤–ª—é—î–º–æ city, —â–æ–± –¥–æ–¥–∞—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è –ø–æ–≤–Ω–æ—ó —Ç–æ—á–Ω–æ—Å—Ç—ñ
                if (astroResult.geoData) {
                    userQuery += ` –ì–µ–æ: lat=${astroResult.geoData.lat}, lon=${astroResult.geoData.lon}, timezone=${astroResult.geoData.timezone}.`;
                }
            }
            
            try {
                const rawReport = await callGeminiAPI(freeSystemPrompt, userQuery);
                const formattedReport = formatReport(rawReport);
                
                // –•–æ–≤–∞—î–º–æ —Å–ø—ñ–Ω–Ω–µ—Ä
                stopLoadingAnimation();
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –∑–≤—ñ—Ç
                if (freeReportContentEl) {
                    freeReportContentEl.innerHTML = formattedReport;
                }
            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É:", error);
                freeReportContentEl.innerHTML = `<p class="text-red-400 text-center py-8">–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.</p>`;
            }
        }
        
        // --- 5.2. –ó–ê–ü–£–°–ö –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ü–û–í–ù–û–ì–û –∑–≤—ñ—Ç—É (–ö—Ä–æ–∫ 7)
        async function fetchFullAnalysis(data, astroResult) {
            
            // –î–æ–¥–∞—î–º–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –¥–æ –ø—Ä–æ–º–ø—Ç—É
            let userQuery = `–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è: ${data.date}.`;
            if (data.time) userQuery += ` –ß–∞—Å: ${data.time}.`;
            if (data.city) userQuery += ` –ú—ñ—Å—Ç–æ: ${data.city}.`;
            
            // –î–û–î–ê–ù–û: –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–∞–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏
            if (astroResult && astroResult.natalChartData) {
                const chart = astroResult.natalChartData;
                userQuery += ` –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–∞–Ω—ñ –Ω–∞—Ç–∞–ª—å–Ω–æ—ó –∫–∞—Ä—Ç–∏ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —ó—Ö —è–∫ —Ç–æ—á–Ω—É –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—á–Ω—É –æ—Å–Ω–æ–≤—É): –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç: ${chart.ascendant} –≥—Ä. –°–æ–Ω—Ü–µ: ${chart.sun} –≥—Ä. –ú—ñ—Å—è—Ü—å: ${chart.moon} –≥—Ä. –ü–æ–ª–æ–∂–µ–Ω–Ω—è –ø–ª–∞–Ω–µ—Ç: ${chart.planetPositions}. –ö—É—Å–ø—ñ–¥–∏ –î–æ–º—ñ–≤: [${chart.houses.join(', ')}].`;
                // –û–Ω–æ–≤–ª—é—î–º–æ city, —â–æ–± –¥–æ–¥–∞—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è –ø–æ–≤–Ω–æ—ó —Ç–æ—á–Ω–æ—Å—Ç—ñ
                if (astroResult.geoData) {
                    userQuery += ` –ì–µ–æ: lat=${astroResult.geoData.lat}, lon=${astroResult.geoData.lon}, timezone=${astroResult.geoData.timezone}.`;
                }
            }

            try {
                const rawReport = await callGeminiAPI(fullSystemPrompt, userQuery);
                const formattedReport = formatReport(rawReport);
                
                // –•–æ–≤–∞—î–º–æ —Å–ø—ñ–Ω–Ω–µ—Ä
                if (reportLoadingIndicator) reportLoadingIndicator.style.display = 'none';
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –∑–≤—ñ—Ç
                if (fullReportContentEl) {
                    fullReportContentEl.innerHTML = formattedReport;
                    fullReportContentEl.style.display = 'block';
                }
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –∞–ø—Å–µ–ª-–±–æ–∫—Å
                if (ltvUpsellBox) ltvUpsellBox.style.display = 'block';

                // (–¢—É—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ –º–∏ –± –≤—ñ–¥–ø—Ä–∞–≤–∏–ª–∏ `formattedReport`
                // –Ω–∞ –±–µ–∫–µ–Ω–¥ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –Ω–∞ email, —è–∫–∏–π –º–∏ –∑—ñ–±—Ä–∞–ª–∏)
                console.log("Email to send:", data.email);
                console.log("Report HTML:", formattedReport);
            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É:", error);
                fullReportContentEl.innerHTML = `<p class="text-red-400 text-center py-8">–ü–æ–º–∏–ª–∫–∞: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –∑–≤—ñ—Ç.</p>`;
                if (reportLoadingIndicator) reportLoadingIndicator.style.display = 'none';
            }
        }

        // --- 6. –û–ë–†–û–ë–ù–ò–ö–ò –ö–ù–û–ü–û–ö —Ç–∞ –§–û–†–ú ---
        
        // --- 6.1. –û–ë–†–û–ë–ù–ò–ö –§–û–†–ú–ò –î–ê–ù–ò–• –ù–ê–†–û–î–ñ–ï–ù–ù–Ø (–ö—Ä–æ–∫ 1) ---
        birthForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            stopLoadingAnimation(); // –ó—É–ø–∏–Ω—è—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é, —è–∫—â–æ –≤–æ–Ω–∞ –ø—Ä–∞—Ü—é—î

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö
            if (!birthDateInput.value || !birthCityInput.value.trim()) {
                 alertModal("–ü–æ–º–∏–ª–∫–∞", "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ –º—ñ—Å—Ç–æ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.");
                 return;
            }

            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ
            userData = {
                date: birthDateInput.value,
                time: birthTimeInput.value || '12:00', // –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ 12:00, —è–∫—â–æ —á–∞—Å –Ω–µ –≤–∫–∞–∑–∞–Ω–æ
                city: birthCityInput.value.trim(),
                email: '', // –ë—É–¥–µ –æ–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –ö—Ä–æ—Ü—ñ 4
            };
            
            // 1. –ó–º—ñ–Ω–∞ —Å—Ç–∞–Ω—É –Ω–∞ 'loading' (–ö—Ä–æ–∫ 2)
            showStep(2); 

            try {
                // --- –ù–û–í–ò–ô –ö–†–û–ö: –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–∞ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ê—Å—Ç—Ä–æ-–î–∞–Ω–∏—Ö ---
                const astroResult = await getAstroData(userData.city, userData.date, userData.time);
                
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≥–ª–æ–±–∞–ª—å–Ω–æ, —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ
                userData.astroData = astroResult;

                // 2. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É (–ö—Ä–æ–∫ 3)
                await fetchFreeAnalysis(userData, astroResult);

                // 3. –ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É (–ö—Ä–æ–∫ 3)
                showStep(3);

            } catch (error) {
                // –ü–æ–º–∏–ª–∫–∞ –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω–∞ –≤ getAstroData/fetchFreeAnalysis
                console.error("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–æ—Ü–µ—Å—É (–ö—Ä–æ–∫ 1):", error);
            }
        });
        
        // --- 6.2. –ö–ù–û–ü–ö–ê "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏" (–ö—Ä–æ–∫ 3) ---
        if (showPremiumDataBtn) {
            showPremiumDataBtn.addEventListener('click', () => {
                // –ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ email –∑ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ–≥–æ –ø–æ–ª—è, —è–∫—â–æ –≤—ñ–Ω –±—É–≤
                premiumEmailInput.value = userData.email; 
                showStep(4);
            });
        }
        
        // --- 6.3. –§–û–†–ú–ê –ó–ë–û–†–£ EMAIL (–ö—Ä–æ–∫ 4) ---
        emailForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = premiumEmailInput.value.trim();
            if (!email) {
                alertModal("–ü–æ–º–∏–ª–∫–∞", "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π email.");
                return;
            }
            userData.email = email;
            showStep(5);
        });

        // --- 6.4. –ö–ù–û–ü–ö–ê –û–ü–õ–ê–¢–ò (–ö—Ä–æ–∫ 5) ---
        if (payButton) {
            payButton.addEventListener('click', () => {
                // –Ü–º—ñ—Ç–∞—Ü—ñ—è –≤–∏–∫–ª–∏–∫—É WayForPay / —ñ–Ω—à–æ–≥–æ –ø–ª–∞—Ç—ñ–∂–Ω–æ–≥–æ —à–ª—é–∑—É
                // –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ —Ç—É—Ç –±—É–≤ –±–∏ POST-–∑–∞–ø–∏—Ç –Ω–∞ –±–µ–∫–µ–Ω–¥
                alertModal("–Ü–º—ñ—Ç–∞—Ü—ñ—è –û–ø–ª–∞—Ç–∏", "–£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ —Ç—É—Ç –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è WayForPay. –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ.");
                isPaymentSuccessful = true;
                // –Ü–º—ñ—Ç—É—î–º–æ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ WayForPay –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ?payment=success
                handlePaymentReturn(); 
            });
        }
        
        // --- 6.5. –û–ë–†–û–ë–ù–ò–ö –ü–û–í–ï–†–ù–ï–ù–ù–Ø –ó –û–ü–õ–ê–¢–ò (WayForPay) ---
        function handlePaymentReturn() {
            // –£ —Å–ø—Ä–æ—â–µ–Ω–æ–º—É –≤–∞—Ä—ñ–∞–Ω—Ç—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É, –∞–±–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ URL
            const urlParams = new URLSearchParams(window.location.search);
            if (isPaymentSuccessful || urlParams.get('payment') === 'success') {
                showStep(6);
                // –ó–∞–ø—É—Å–∫–∞—î–º–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –ø–æ–≤–Ω–æ–≥–æ –∑–≤—ñ—Ç—É
                if (userData.date && userData.email && userData.astroData) {
                     // –ü–µ—Ä–µ–∫–æ–Ω—É—î–º–æ—Å—å, —â–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∏–¥–∏–º–∏–π
                    if (reportLoadingIndicator) reportLoadingIndicator.style.display = 'block';
                    fetchFullAnalysis(userData, userData.astroData);
                } else {
                    // –Ø–∫—â–æ –¥–∞–Ω—ñ –≤—Ç—Ä–∞—á–µ–Ω—ñ, –ø—Ä–æ—Å–∏–º–æ –≤–≤–µ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ
                    alertModal("–ü–æ–º–∏–ª–∫–∞", "–î–∞–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –≤—Ç—Ä–∞—á–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–æ—á–Ω—ñ—Ç—å —Å–ø–æ—á–∞—Ç–∫—É.");
                    showStep(1); 
                }
            }
        }


        // --- 7. –õ–û–ì–Ü–ö–ê –ü–õ–ï–ô–°–•–û–õ–î–ï–†–Ü–í (–ï—Å—Ç–µ—Ç–∏–∫–∞) ---
        
        // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ –î–∞—Ç–∏
        function updateDatePlaceholder() {
            if (birthDateInput.value === '') {
                datePlaceholder.innerText = '–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É';
                datePlaceholder.style.color = 'var(--secondary-text-color)';
                birthDateInput.type = 'text'; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–±–æ—Ä—É
            } else {
                // –§–æ—Ä–º–∞—Ç—É—î–º–æ –¥–∞—Ç—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                const dateObj = new Date(birthDateInput.value);
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                datePlaceholder.innerText = dateObj.toLocaleDateString('uk-UA', options);
                datePlaceholder.style.color = 'var(--primary-text-color)';
                birthDateInput.type = 'date'; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ type –¥–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            }
        }
        
        // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞ –ß–∞—Å—É
        function updateTimePlaceholder() {
            if (birthTimeInput.value === '') {
                timePlaceholder.innerText = '–û–±–µ—Ä—ñ—Ç—å —á–∞—Å (–±–∞–∂–∞–Ω–æ)';
                timePlaceholder.style.color = 'var(--secondary-text-color)';
                birthTimeInput.type = 'text';
            } else {
                // –ß–∞—Å –≤–∂–µ —É —Ñ–æ—Ä–º–∞—Ç—ñ HH:MM
                timePlaceholder.innerText = birthTimeInput.value;
                timePlaceholder.style.color = 'var(--primary-text-color)'; // –†–æ–±–∏–º–æ –æ–±—Ä–∞–Ω–∏–π —á–∞—Å —è—Å–∫—Ä–∞–≤–∏–º
                birthTimeInput.type = 'time';
            }
        }

        // --- 8. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
        document.addEventListener('DOMContentLoaded', () => {
            // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á—ñ–≤ –¥–ª—è –º–∏—Ç—Ç—î–≤–æ—ó —Ä–µ–∞–∫—Ü—ñ—ó –î–∞—Ç–∏
            birthDateInput.addEventListener('input', updateDatePlaceholder);
            birthDateInput.addEventListener('change', updateDatePlaceholder);
            updateDatePlaceholder();

            // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á—ñ–≤ –¥–ª—è –º–∏—Ç—Ç—î–≤–æ—ó —Ä–µ–∞–∫—Ü—ñ—ó –ß–∞—Å—É
            birthTimeInput.addEventListener('input', updateTimePlaceholder);
            birthTimeInput.addEventListener('change', updateTimePlaceholder);
            updateTimePlaceholder();

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–∏ –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –∑ WayForPay
            handlePaymentReturn();

        });
    </script>
</body>
</html>
