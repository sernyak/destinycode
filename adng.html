<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Library Hunter (v2)</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #0d1117; color: #c9d1d9; padding: 20px; line-height: 1.5; }
        .box { padding: 15px; border: 1px solid #30363d; margin-bottom: 10px; border-radius: 6px; background: #161b22; }
        .title { font-weight: bold; color: #58a6ff; margin-bottom: 5px; }
        .success { border-color: #2ea043; color: #2ea043; }
        .fail { border-color: #da3633; color: #da3633; }
        .pending { border-color: #d29922; color: #d29922; }
        h1 { color: #f0f6fc; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
        #final-verdict { font-size: 1.2em; font-weight: bold; margin-top: 20px; padding: 20px; text-align: center; }
    </style>
</head>
<body>

    <h1>üõ∞Ô∏è Astro Library Hunter</h1>
    <p>Testing multiple delivery networks to find a working source...</p>

    <div id="results-container"></div>
    <div id="final-verdict" class="box" style="display:none;"></div>

    <!-- Hidden chart for rendering test -->
    <div id="test-chart" style="width: 1px; height: 1px; overflow: hidden;"></div>

    <script type="module">
        const container = document.getElementById('results-container');
        const verdictBox = document.getElementById('final-verdict');
        const testChart = document.getElementById('test-chart');

        // –°–ø–∏—Å–æ–∫ –¥–∂–µ—Ä–µ–ª –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
        const sources = [
            {
                name: "ORIGINAL (Browser Build)",
                type: "script",
                url: "https://cdn.jsdelivr.net/npm/circular-natal-horoscope-js/dist/circular-natal-horoscope-js.browser.min.js"
            },
            {
                name: "UNPKG (Index Dist)",
                type: "script",
                url: "https://unpkg.com/circular-natal-horoscope-js@1.1.0/dist/index.js"
            },
            {
                name: "JSDELIVR (Fallback Min)",
                type: "script",
                url: "https://cdn.jsdelivr.net/npm/circular-natal-horoscope-js@1.0.3/dist/circular-natal-horoscope-js.min.js"
            },
            {
                name: "ESM.SH (Modern Module)",
                type: "module",
                url: "https://esm.sh/circular-natal-horoscope-js@1.1.0"
            }
        ];

        async function testSource(source) {
            const div = document.createElement('div');
            div.className = 'box pending';
            div.innerHTML = `<div class="title">Testing: ${source.name}</div>Loading...`;
            container.appendChild(div);

            return new Promise((resolve) => {
                if (source.type === 'script') {
                    // Clean up previous globals
                    window.CircularNatalHoroscope = undefined;
                    
                    const script = document.createElement('script');
                    script.src = source.url;
                    script.onload = () => {
                        if (window.CircularNatalHoroscope) {
                            div.className = 'box success';
                            div.innerHTML = `<div class="title">${source.name}</div>‚úÖ LOADED (Global Variable found)`;
                            resolve({ success: true, url: source.url, type: 'script' });
                        } else {
                            div.className = 'box fail';
                            div.innerHTML = `<div class="title">${source.name}</div>‚ùå Script loaded but window.CircularNatalHoroscope is missing.`;
                            resolve({ success: false });
                        }
                        script.remove(); // Cleanup
                    };
                    script.onerror = () => {
                        div.className = 'box fail';
                        div.innerHTML = `<div class="title">${source.name}</div>‚ùå Network Error / 404`;
                        resolve({ success: false });
                        script.remove();
                    };
                    document.head.appendChild(script);
                } 
                else if (source.type === 'module') {
                    import(source.url)
                        .then(module => {
                            if (module.Origin && module.Horoscope) {
                                div.className = 'box success';
                                div.innerHTML = `<div class="title">${source.name}</div>‚úÖ LOADED (ES Module Import)`;
                                resolve({ success: true, url: source.url, type: 'module' });
                            } else {
                                div.className = 'box fail';
                                div.innerHTML = `<div class="title">${source.name}</div>‚ùå Module loaded but exports are missing.`;
                                resolve({ success: false });
                            }
                        })
                        .catch(err => {
                            div.className = 'box fail';
                            div.innerHTML = `<div class="title">${source.name}</div>‚ùå Import Failed: ${err.message}`;
                            resolve({ success: false });
                        });
                }
            });
        }

        async function runTests() {
            let winner = null;

            for (const src of sources) {
                const result = await testSource(src);
                if (result.success && !winner) {
                    winner = result;
                    // –ú–∏ –Ω–µ –∑—É–ø–∏–Ω—è—î–º–æ—Å—å, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å –≤—Å—ñ—Ö, –∞–ª–µ –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î–º–æ –ø–µ—Ä—à–æ–≥–æ —Ä–æ–±–æ—á–æ–≥–æ
                }
            }

            verdictBox.style.display = 'block';
            if (winner) {
                verdictBox.className = 'box success';
                verdictBox.innerHTML = `
                    <h3>üéâ WE HAVE A WINNER!</h3>
                    <p>The working source is: <strong>${winner.url}</strong></p>
                    <p>Type: <strong>${winner.type}</strong></p>
                    <p>PLEASE TELL THE DEVELOPER TO USE THIS URL.</p>
                `;
            } else {
                verdictBox.className = 'box fail';
                verdictBox.innerHTML = `
                    <h3>üíÄ TOTAL FAILURE</h3>
                    <p>None of the libraries loaded. This might be a firewall issue, or the library has been wiped from CDNs.</p>
                `;
            }
        }

        runTests();
    </script>
</body>
</html>
